{"version":3,"file":"index.js","sources":["../src/utils.js","../src/jsx.js","../src/SnabbdomComponent.js"],"sourcesContent":["export function tryFlatten (array) {\n  if (Array.isArray(array)) {\n    return flatten(array, [])\n  }\n\n  return array\n}\n\nfunction flatten (array, start) {\n  for (let i = 0; i < array.length; i++) {\n    const elm = array[i]\n\n    if (Array.isArray(elm)) {\n      flatten(elm, start)\n    } else {\n      start.push(elm)\n    }\n  }\n\n  return start\n}\n\nexport function isPrimitive (val) {\n  return (\n    typeof val === 'string' ||\n    typeof val === 'number' ||\n    typeof val === 'boolean' ||\n    typeof val === 'symbol' ||\n    val === null ||\n    val === undefined\n  )\n}\n\nexport function isClass (val) {\n  return (\n    isFunc(val) &&\n    !!val.prototype.snabbdomComponent &&\n    typeof val.prototype.render === 'function'\n  )\n}\n\nexport function isFunc (val) {\n  return typeof val === 'function'\n}\n\nexport function isObj (val) {\n  return typeof val === 'object'\n}\n\nexport function isSvg (val) {\n  return (\n    val &&\n    typeof val === 'string' &&\n    val[0] === 's' &&\n    val[1] === 'v' &&\n    val[2] === 'g' &&\n    (val.length === 3 || val[3] === '.' || val[3] === '#')\n  )\n}\n","import { tryFlatten, isPrimitive, isClass, isFunc, isObj, isSvg } from './utils'\n\nconst DEF_NS = 'props'\nconst DEF_MODS = ['hook', 'on', 'style', 'class', 'props', 'attrs', 'dataset']\nconst SVG_NS = 'http://www.w3.org/2000/svg'\n\nexport function normalizeAttrs (attrs) {\n  const map = {}\n\n  for (let key in attrs) {\n    if (DEF_MODS.includes(key)) {\n      map[key] = attrs[key]\n    } else if (key !== 'key' && key !== 'classNames' && key !== 'selector') {\n      const idx = key.indexOf('-')\n      if (idx !== -1) {\n        const nsKey = key.substring(0, idx)\n        const attrsKey = key.substring(idx + 1)\n        addAttr(nsKey, attrsKey, attrs[key])\n      } else if (!map[key]) {\n        addAttr(DEF_NS, key, attrs[key])\n      }\n    }\n  }\n\n  return map\n\n  function addAttr (nsKey, key, val) {\n    const ns = map[nsKey] || {}\n    ns[key] = val\n    map[nsKey] = ns\n  }\n}\n\nfunction buildFromStringTag (tag, attrs, children) {\n  if (attrs.selector && attrs.selector !== '') {\n    tag = tag + attrs.selector\n  }\n\n  if (\n    attrs.classNames &&\n    ((Array.isArray(attrs.classNames) && attrs.classNames.length !== 0) ||\n      attrs.classNames !== '')\n  ) {\n    const cns = attrs.classNames\n    tag =\n      tag +\n      '.' +\n      (Array.isArray(cns) ? cns.join('.') : cns.replace(/\\s+/g, '.'))\n  }\n\n  return {\n    sel: tag,\n    data: normalizeAttrs(attrs),\n    children: children.map(c => (isPrimitive(c) ? { text: c } : c)),\n    key: attrs.key\n  }\n}\n\nfunction buildFromComponent (tag, attrs, children) {\n  let res\n  const isClass_ = isClass(tag)\n  const isFunc_ = isFunc(tag)\n  const hasRender_ = isObj(tag) && typeof tag.render === 'function'\n\n  if (isClass_) {\n    const Tag = tag\n    res = new Tag(attrs, children).render()\n  } else if (hasRender_) {\n    res = tag.render(attrs, children)\n  } else if (isFunc_) {\n    res = tag(attrs, children)\n  } else {\n    console.error(\n      'JSX tag error: tag =',\n      tag,\n      ', attrs =',\n      attrs,\n      ', children =',\n      children\n    )\n    throw new Error(\n      `JSX tag must be either a 'string', a 'function' or\n      an 'object'/a 'class' with either a 'view' or a 'render' method.`\n    )\n  }\n\n  if (res) {\n    res.key = attrs.key\n  }\n\n  return res\n}\n\nfunction mapPropsToAttrs (data) {\n  const attrs = data.attrs || (data.attrs = {})\n  const props = data.props || (data.props = {})\n\n  for (let key in props) {\n    if (attrs[key] === undefined) {\n      attrs[key] = props[key]\n      delete props[key]\n    }\n  }\n\n  data.attrs = attrs\n\n  if (Object.keys(props).length > 0) {\n    data.props = props\n  } else {\n    delete data.props\n  }\n\n  return data\n}\n\nfunction addNSAndAttrs (vnode) {\n  const data = vnode.data || {}\n  data.ns = SVG_NS\n  vnode.data = mapPropsToAttrs(data)\n\n  if (vnode.sel !== 'foreignObject') {\n    for (let i = 0; i < vnode.children.length; i++) {\n      addNSAndAttrs(vnode.children[i])\n    }\n  }\n}\n\nfunction buildVnode (tag, attrs, children) {\n  children = tryFlatten(children)\n\n  if (typeof tag === 'string') {\n    const vnode = buildFromStringTag(tag, attrs, children)\n    const sel = vnode.sel\n\n    if (isSvg(sel)) {\n      addNSAndAttrs(vnode)\n    }\n\n    return vnode\n  } else {\n    return buildFromComponent(tag, attrs, children)\n  }\n}\n\nexport default function html (tag, attrs, children) {\n  attrs = attrs || {}\n  children = children || []\n  if (typeof attrs !== 'object') {\n    console.error(\n      'JSX attrs error: tag =',\n      tag,\n      ', attrs =',\n      attrs,\n      ', children =',\n      children\n    )\n    throw new Error(\"JSX attrs must be of type 'object'.\")\n  }\n\n  if (arguments.length > 3 || !Array.isArray(children)) {\n    children = Array.prototype.slice.call(arguments, 2)\n  }\n\n  return buildVnode(tag, attrs, children)\n}\n","export default class SnabbdomComponent {\n  constructor (props_ = {}, children_ = []) {\n    this.props = props_\n    this.children = children_\n  }\n}\n\nSnabbdomComponent.prototype.snabbdomComponent = true\nSnabbdomComponent.prototype.render = function () {\n  throw new Error(\n    \"Subclasses must override 'render' to return a properly configured 'class SnabbdomComponent'.\"\n  )\n}\n"],"names":["tryFlatten","array","Array","isArray","flatten","start","i","length","elm","push","isPrimitive","val","undefined","isClass","isFunc","prototype","snabbdomComponent","render","isObj","isSvg","DEF_NS","DEF_MODS","SVG_NS","normalizeAttrs","attrs","map","key","includes","idx","indexOf","nsKey","substring","attrsKey","addAttr","ns","buildFromStringTag","tag","children","selector","classNames","cns","join","replace","c","text","buildFromComponent","res","isClass_","isFunc_","hasRender_","Tag","error","Error","mapPropsToAttrs","data","props","Object","keys","addNSAndAttrs","vnode","sel","buildVnode","html","arguments","slice","call","SnabbdomComponent","props_","children_"],"mappings":"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"}