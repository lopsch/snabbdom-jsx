{"version":3,"sources":["../src/jsx.js"],"names":["normalizeAttrs","html","DEF_NS","DEF_MODS","SVG_NS","attrs","map","key","includes","idx","indexOf","nsKey","substring","attrsKey","addAttr","val","ns","buildFromStringTag","tag","children","selector","classNames","Array","isArray","length","cns","join","replace","sel","data","c","text","buildFromComponent","res","_isClass","_isFunc","_hasRender","render","Tag","console","error","Error","mapPropsToAttrs","props","undefined","Object","keys","addNSAndAttrs","vnode","i","buildVnode","arguments","prototype","slice","call"],"mappings":"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","file":"jsx.js","sourcesContent":["import { tryFlatten, isPrimitive, isClass, isFunc, isObj, isSvg } from './utils'\n\nconst DEF_NS = 'props'\nconst DEF_MODS = ['hook', 'on', 'style', 'class', 'props', 'attrs', 'dataset']\nconst SVG_NS = 'http://www.w3.org/2000/svg'\n\nexport function normalizeAttrs (attrs) {\n  const map = {}\n\n  for (let key in attrs) {\n    if (DEF_MODS.includes(key)) {\n      map[key] = attrs[key]\n    } else if (key !== 'key' && key !== 'classNames' && key !== 'selector') {\n      const idx = key.indexOf('-')\n      if (idx !== -1) {\n        const nsKey = key.substring(0, idx)\n        const attrsKey = key.substring(idx + 1)\n        addAttr(nsKey, attrsKey, attrs[key])\n      } else if (!map[key]) {\n        addAttr(DEF_NS, key, attrs[key])\n      }\n    }\n  }\n\n  return map\n\n  function addAttr (nsKey, key, val) {\n    const ns = map[nsKey] || {}\n    ns[key] = val\n    map[nsKey] = ns\n  }\n}\n\nfunction buildFromStringTag (tag, attrs, children) {\n  if (attrs.selector && attrs.selector !== '') {\n    tag = tag + attrs.selector\n  }\n\n  if (\n    attrs.classNames &&\n    ((Array.isArray(attrs.classNames) && attrs.classNames.length !== 0) ||\n      attrs.classNames !== '')\n  ) {\n    const cns = attrs.classNames\n    tag =\n      tag +\n      '.' +\n      (Array.isArray(cns) ? cns.join('.') : cns.replace(/\\s+/g, '.'))\n  }\n\n  return {\n    sel: tag,\n    data: normalizeAttrs(attrs),\n    children: children.map(c => (isPrimitive(c) ? { text: c } : c)),\n    key: attrs.key\n  }\n}\n\nfunction buildFromComponent (tag, attrs, children) {\n  let res\n  const _isClass = isClass(tag)\n  const _isFunc = isFunc(tag)\n  const _hasRender = isObj(tag) && typeof tag.render === 'function'\n\n  if (_isClass) {\n    const Tag = tag\n    res = new Tag(attrs, children).render()\n  } else if (_hasRender) {\n    res = tag.render(attrs, children)\n  } else if (_isFunc) {\n    res = tag(attrs, children)\n  } else {\n    console.error(\n      'JSX tag error: tag =',\n      tag,\n      ', attrs =',\n      attrs,\n      ', children =',\n      children\n    )\n    throw new Error(\n      `JSX tag must be either a 'string', a 'function' or\n      an 'object'/a 'class' with either a 'view' or a 'render' method.`\n    )\n  }\n\n  if (res) {\n    res.key = attrs.key\n  }\n\n  return res\n}\n\nfunction mapPropsToAttrs (data) {\n  const attrs = data.attrs || (data.attrs = {})\n  const props = data.props || (data.props = {})\n\n  for (let key in props) {\n    if (attrs[key] === undefined) {\n      attrs[key] = props[key]\n      delete props[key]\n    }\n  }\n\n  data.attrs = attrs\n\n  if (Object.keys(props).length > 0) {\n    data.props = props\n  } else {\n    delete data.props\n  }\n\n  return data\n}\n\nfunction addNSAndAttrs (vnode) {\n  const data = vnode.data || {}\n  data.ns = SVG_NS\n  vnode.data = mapPropsToAttrs(data)\n\n  if (vnode.sel !== 'foreignObject') {\n    for (let i = 0; i < vnode.children.length; i++) {\n      addNSAndAttrs(vnode.children[i])\n    }\n  }\n}\n\nfunction buildVnode (tag, attrs, children) {\n  children = tryFlatten(children)\n\n  if (typeof tag === 'string') {\n    const vnode = buildFromStringTag(tag, attrs, children)\n    const sel = vnode.sel\n\n    if (isSvg(sel)) {\n      addNSAndAttrs(vnode)\n    }\n\n    return vnode\n  } else {\n    return buildFromComponent(tag, attrs, children)\n  }\n}\n\nexport default function html (tag, attrs, children) {\n  attrs = attrs || {}\n  children = children || []\n  if (typeof attrs !== 'object') {\n    console.error(\n      'JSX attrs error: tag =',\n      tag,\n      ', attrs =',\n      attrs,\n      ', children =',\n      children\n    )\n    throw new Error(\"JSX attrs must be of type 'object'.\")\n  }\n\n  if (arguments.length > 3 || !Array.isArray(children)) {\n    children = Array.prototype.slice.call(arguments, 2)\n  }\n\n  return buildVnode(tag, attrs, children)\n}\n"]}